generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Member {
  id             Int          @id @default(autoincrement())
  username       String       @unique
  email          String       @unique
  role           MemberRole   @default(FRESHY)
  status         MemberStatus @default(FREEZE)
  reputation     Int          @default(0)
  coins          Int          @default(0)
  this_or_that   String[]
  maximum_member Int          @default(1)

  created_codes  Code[] @relation("Create")
  redeemed_codes Code[] @relation("Redeem")

  paired_member_id Int?
  paired_member    Member?  @relation("PairedMembers", fields: [paired_member_id], references: [id])
  paired_with      Member[] @relation("PairedMembers")

  code Code[]
}

model Code {
  id       Int     @id @default(autoincrement())
  code     String
  is_used  Boolean @default(false)
  disabled Boolean @default(false)

  redeemed_by_id Int?
  redeemed_by    Member? @relation("Redeem", fields: [redeemed_by_id], references: [id])

  creator_id Int
  creator    Member @relation("Create", fields: [creator_id], references: [id])

  member   Member? @relation(fields: [memberId], references: [id])
  memberId Int?
}

enum MemberStatus {
  PAIRED
  UNPAIR
  FREEZE
}

enum MemberRole {
  FRESHY
  SOPHOMORE
}
